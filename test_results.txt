============================= test session starts ==============================
platform darwin -- Python 3.12.9, pytest-8.4.2, pluggy-1.5.0 -- /Users/ara/miniconda3/bin/python
cachedir: .pytest_cache
rootdir: /Users/ara/GitHub/ear-vision-ml
configfile: pyproject.toml
testpaths: tests
plugins: anyio-4.11.0, xdist-3.8.0, hydra-core-1.3.2
collecting ... collected 103 items

tests/integration/test_dataset_build_smoke.py::test_load_dataset_smoke PASSED [  0%]
tests/integration/test_dataset_build_smoke.py::test_load_dataset_invalid_split PASSED [  1%]
tests/integration/test_export_smoke.py::test_export_smoke PASSED         [  2%]
tests/integration/test_image_runtime_smoke.py::test_single_image_inference PASSED [  3%]
tests/integration/test_image_runtime_smoke.py::test_batch_inference PASSED [  4%]
tests/integration/test_image_runtime_smoke.py::test_tta_inference PASSED [  5%]
tests/integration/test_image_runtime_smoke.py::test_run_image_inference PASSED [  6%]
tests/integration/test_image_runtime_smoke.py::test_gradcam SKIPPED      [  7%]
tests/integration/test_training_smoke.py::test_classification_training_smoke PASSED [  8%]
tests/integration/test_training_smoke.py::test_segmentation_training_smoke PASSED [  9%]
tests/integration/test_video_runtime_smoke.py::test_video_runtime_smoke PASSED [ 10%]
tests/unit/test_ab_test.py::test_compare_means_significant PASSED        [ 11%]
tests/unit/test_ab_test.py::test_compare_means_not_significant PASSED    [ 12%]
tests/unit/test_ab_test.py::test_compare_proportions_significant PASSED  [ 13%]
tests/unit/test_ab_test.py::test_compare_proportions_not_significant PASSED [ 14%]
tests/unit/test_ab_test.py::test_calculate_sample_size PASSED            [ 15%]
tests/unit/test_attribution.py::test_attribution_run PASSED              [ 16%]
tests/unit/test_attribution.py::test_integrated_gradients_shape PASSED   [ 17%]
tests/unit/test_data_loader_strategy.py::TestPreprocessorStrategy::test_preprocessor_is_abstract PASSED [ 18%]
tests/unit/test_data_loader_strategy.py::TestPreprocessorStrategy::test_classification_preprocessor_exists PASSED [ 19%]
tests/unit/test_data_loader_strategy.py::TestPreprocessorStrategy::test_segmentation_preprocessor_exists PASSED [ 20%]
tests/unit/test_data_loader_strategy.py::TestSyntheticDataLoader::test_synthetic_loader_classification PASSED [ 21%]
tests/unit/test_data_loader_strategy.py::TestSyntheticDataLoader::test_synthetic_loader_segmentation PASSED [ 22%]
tests/unit/test_data_loader_strategy.py::TestSyntheticDataLoader::test_synthetic_loader_cropper PASSED [ 23%]
tests/unit/test_data_loader_strategy.py::TestDataLoaderFactory::test_factory_returns_synthetic_loader PASSED [ 24%]
tests/unit/test_data_loader_strategy.py::TestDataLoaderFactory::test_factory_returns_manifest_loader_for_classification PASSED [ 25%]
tests/unit/test_data_loader_strategy.py::TestDataLoaderFactory::test_factory_returns_manifest_loader_for_segmentation PASSED [ 26%]
tests/unit/test_data_loader_strategy.py::TestDataLoaderFactory::test_loader_implements_interface PASSED [ 27%]
tests/unit/test_data_loader_strategy.py::TestDataLoaderConsistency::test_train_and_val_have_same_structure PASSED [ 28%]
tests/unit/test_dataset_audit.py::test_dataset_audit_run PASSED          [ 29%]
tests/unit/test_dataset_audit.py::test_dataset_audit_no_manifest PASSED  [ 30%]
tests/unit/test_dataset_manifest_schema.py::test_manifest_schema_valid PASSED [ 31%]
tests/unit/test_dataset_manifest_schema.py::test_manifest_schema_missing_required PASSED [ 32%]
tests/unit/test_dataset_manifest_schema.py::test_manifest_schema_invalid_enum PASSED [ 33%]
tests/unit/test_di_container.py::TestDIContainer::test_register_and_resolve_singleton PASSED [ 33%]
tests/unit/test_di_container.py::TestDIContainer::test_register_and_resolve_factory PASSED [ 34%]
tests/unit/test_di_container.py::TestDIContainer::test_resolve_unregistered_service_raises_error PASSED [ 35%]
tests/unit/test_di_container.py::TestDIContainer::test_multiple_service_types PASSED [ 36%]
tests/unit/test_di_container.py::TestDIContainer::test_get_container_returns_global_instance PASSED [ 37%]
tests/unit/test_di_container.py::TestInterfaces::test_model_builder_interface PASSED [ 38%]
tests/unit/test_di_container.py::TestInterfaces::test_data_loader_interface PASSED [ 39%]
tests/unit/test_di_container.py::TestInterfaces::test_trainer_interface PASSED [ 40%]
tests/unit/test_di_container.py::TestInterfaces::test_exporter_interface PASSED [ 41%]
tests/unit/test_di_container.py::TestInterfaceContracts::test_model_builder_contract PASSED [ 42%]
tests/unit/test_di_container.py::TestInterfaceContracts::test_trainer_contract PASSED [ 43%]
tests/unit/test_di_container.py::TestInterfaceContracts::test_exporter_contract PASSED [ 44%]
tests/unit/test_di_container.py::TestInterfaceContracts::test_data_loader_contract PASSED [ 45%]
tests/unit/test_distillation.py::test_distillation_loss_computation PASSED [ 46%]
tests/unit/test_distillation.py::test_distiller_train_step PASSED        [ 47%]
tests/unit/test_distillation.py::test_distiller_call_delegates_to_student PASSED [ 48%]
tests/unit/test_drift_detection.py::test_psi_no_drift PASSED             [ 49%]
tests/unit/test_drift_detection.py::test_psi_significant_drift PASSED    [ 50%]
tests/unit/test_drift_detection.py::test_ks_statistic PASSED             [ 51%]
tests/unit/test_drift_detection.py::test_detect_drift_full PASSED        [ 52%]
tests/unit/test_ensembles.py::test_soft_vote PASSED                      [ 53%]
tests/unit/test_ensembles.py::test_ensemble_runtime PASSED               [ 54%]
tests/unit/test_explain_cli.py::test_cli_smoke PASSED                    [ 55%]
tests/unit/test_explain_reports.py::test_prediction_reporter PASSED      [ 56%]
tests/unit/test_explain_reports.py::test_video_explainer PASSED          [ 57%]
tests/unit/test_explain_segmentation.py::test_segmentation_explain_binary PASSED [ 58%]
tests/unit/test_explain_segmentation.py::test_segmentation_explain_multiclass PASSED [ 59%]
tests/unit/test_explain_segmentation.py::test_entropy_computation PASSED [ 60%]
tests/unit/test_labelbox_ingest.py::test_load_labelbox_json_simple PASSED [ 61%]
tests/unit/test_labelbox_ingest.py::test_load_labelbox_json_wrapped PASSED [ 62%]
tests/unit/test_labelbox_ingest.py::test_normalise_to_dataframe PASSED   [ 63%]
tests/unit/test_logging.py::test_setup_logging PASSED                    [ 64%]
tests/unit/test_logging.py::test_get_logger PASSED                       [ 65%]
tests/unit/test_logging.py::test_logger_with_context PASSED              [ 66%]
tests/unit/test_logging.py::test_experiment_logger PASSED                [ 66%]
tests/unit/test_logging.py::test_experiment_reporter_setup PASSED        [ 67%]
tests/unit/test_logging.py::test_experiment_reporter_results PASSED      [ 68%]
tests/unit/test_logging.py::test_create_experiment_report PASSED         [ 69%]
tests/unit/test_model_factory.py::test_build_classification_forward PASSED [ 70%]
tests/unit/test_model_factory.py::test_build_classification_efficientnet PASSED [ 71%]
tests/unit/test_model_factory.py::test_build_classification_resnet50v2 PASSED [ 72%]
tests/unit/test_model_factory.py::test_build_segmentation_forward PASSED [ 73%]
tests/unit/test_model_factory.py::test_build_segmentation_resnet50 PASSED [ 74%]
tests/unit/test_model_factory.py::test_build_cropper_forward PASSED      [ 75%]
tests/unit/test_model_factory.py::test_build_cropper_resnet50v2 PASSED   [ 76%]
tests/unit/test_preprocess_registry.py::test_full_frame_pipeline_outputs_bbox PASSED [ 77%]
tests/unit/test_preprocess_registry.py::test_cropper_fallback_pipeline PASSED [ 78%]
tests/unit/test_registry_pattern.py::TestRegistryPattern::test_register_model_decorator PASSED [ 79%]
tests/unit/test_registry_pattern.py::TestRegistryPattern::test_registry_builder_raises_on_unknown_model PASSED [ 80%]
tests/unit/test_registry_pattern.py::TestRegistryPattern::test_registry_lists_available_models PASSED [ 81%]
tests/unit/test_registry_pattern.py::TestRegistryPattern::test_all_registered_models_are_buildable PASSED [ 82%]
tests/unit/test_registry_pattern.py::TestRegistryPattern::test_backward_compatibility_with_functional_api PASSED [ 83%]
tests/unit/test_registry_pattern.py::TestRegistryPattern::test_registry_builder_implements_interface PASSED [ 84%]
tests/unit/test_registry_pattern.py::TestRegistryPattern::test_case_insensitive_model_names PASSED [ 85%]
tests/unit/test_roi_audit.py::test_roi_audit_run PASSED                  [ 86%]
tests/unit/test_roi_audit.py::test_roi_audit_no_bbox PASSED              [ 87%]
tests/unit/test_roi_contract.py::test_roi_contract_valid PASSED          [ 88%]
tests/unit/test_roi_contract.py::test_roi_contract_invalid_coordinates_range PASSED [ 89%]
tests/unit/test_roi_contract.py::test_roi_contract_invalid_coordinates_order PASSED [ 90%]
tests/unit/test_roi_contract.py::test_roi_contract_invalid_confidence PASSED [ 91%]
tests/unit/test_roi_contract.py::test_roi_contract_full_frame PASSED     [ 92%]
tests/unit/test_standard_trainer.py::TestStandardTrainer::test_trainer_implements_interface PASSED [ 93%]
tests/unit/test_standard_trainer.py::TestStandardTrainer::test_trainer_compiles_model_for_classification FAILED [ 94%]
tests/unit/test_standard_trainer.py::TestStandardTrainer::test_trainer_compiles_model_for_segmentation FAILED [ 95%]
tests/unit/test_standard_trainer.py::TestStandardTrainer::test_trainer_compiles_model_for_cropper FAILED [ 96%]
tests/unit/test_standard_trainer.py::TestStandardTrainer::test_trainer_uses_callbacks FAILED [ 97%]
tests/unit/test_standard_trainer.py::TestStandardTrainer::test_trainer_handles_unknown_task_gracefully FAILED [ 98%]
tests/unit/test_tuning.py::test_vertex_vizier_tuner_report_metrics_local PASSED [ 99%]
tests/unit/test_tuning.py::test_vertex_vizier_tuner_init PASSED          [100%]

=================================== FAILURES ===================================
______ TestStandardTrainer.test_trainer_compiles_model_for_classification ______
tests/unit/test_standard_trainer.py:50: in test_trainer_compiles_model_for_classification
    with patch('src.core.training.standard_trainer.make_callbacks', return_value=[]):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../miniconda3/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
../../miniconda3/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <module 'src.core.training.standard_trainer' from '/Users/ara/GitHub/ear-vision-ml/src/core/training/standard_trainer.py'> does not have the attribute 'make_callbacks'
_______ TestStandardTrainer.test_trainer_compiles_model_for_segmentation _______
tests/unit/test_standard_trainer.py:88: in test_trainer_compiles_model_for_segmentation
    with patch('src.core.training.standard_trainer.make_callbacks', return_value=[]):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../miniconda3/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
../../miniconda3/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <module 'src.core.training.standard_trainer' from '/Users/ara/GitHub/ear-vision-ml/src/core/training/standard_trainer.py'> does not have the attribute 'make_callbacks'
_________ TestStandardTrainer.test_trainer_compiles_model_for_cropper __________
tests/unit/test_standard_trainer.py:122: in test_trainer_compiles_model_for_cropper
    with patch('src.core.training.standard_trainer.make_callbacks', return_value=[]):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../miniconda3/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
../../miniconda3/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <module 'src.core.training.standard_trainer' from '/Users/ara/GitHub/ear-vision-ml/src/core/training/standard_trainer.py'> does not have the attribute 'make_callbacks'
_______________ TestStandardTrainer.test_trainer_uses_callbacks ________________
tests/unit/test_standard_trainer.py:155: in test_trainer_uses_callbacks
    with patch('src.core.training.standard_trainer.make_callbacks', return_value=[mock_callback]):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../miniconda3/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
../../miniconda3/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <module 'src.core.training.standard_trainer' from '/Users/ara/GitHub/ear-vision-ml/src/core/training/standard_trainer.py'> does not have the attribute 'make_callbacks'
_______ TestStandardTrainer.test_trainer_handles_unknown_task_gracefully _______
tests/unit/test_standard_trainer.py:187: in test_trainer_handles_unknown_task_gracefully
    with patch('src.core.training.standard_trainer.make_callbacks', return_value=[]):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../miniconda3/lib/python3.12/unittest/mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
../../miniconda3/lib/python3.12/unittest/mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <module 'src.core.training.standard_trainer' from '/Users/ara/GitHub/ear-vision-ml/src/core/training/standard_trainer.py'> does not have the attribute 'make_callbacks'
=============================== warnings summary ===============================
../../miniconda3/lib/python3.12/site-packages/google/cloud/aiplatform/models.py:52
  /Users/ara/miniconda3/lib/python3.12/site-packages/google/cloud/aiplatform/models.py:52: FutureWarning: Support for google-cloud-storage < 3.0.0 will be removed in a future version of google-cloud-aiplatform. Please upgrade to google-cloud-storage >= 3.0.0.
    from google.cloud.aiplatform.utils import gcs_utils

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
SKIPPED [1] tests/integration/test_image_runtime_smoke.py:157: Grad-CAM requires functional API model in Keras 3
FAILED tests/unit/test_standard_trainer.py::TestStandardTrainer::test_trainer_compiles_model_for_classification
FAILED tests/unit/test_standard_trainer.py::TestStandardTrainer::test_trainer_compiles_model_for_segmentation
FAILED tests/unit/test_standard_trainer.py::TestStandardTrainer::test_trainer_compiles_model_for_cropper
FAILED tests/unit/test_standard_trainer.py::TestStandardTrainer::test_trainer_uses_callbacks
FAILED tests/unit/test_standard_trainer.py::TestStandardTrainer::test_trainer_handles_unknown_task_gracefully
======== 5 failed, 97 passed, 1 skipped, 1 warning in 64.51s (0:01:04) =========
