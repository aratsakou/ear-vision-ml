# @package _global_

# Otoscopic Classification - Baseline Experiment Configuration
# Shared settings for all baseline model training runs

defaults:
  - override /task: classification
  - override /model: cls_mobilenetv3  # Default to MobileNetV3
  - override /data: local
  - override /training: default
  - override /export: tflite
  - override /evaluation: default
  - override /explainability: default

task:
  name: classification

model:
  type: classification
  input_shape: [512, 512, 3]  # Based on preprocessing analysis
  num_classes: 5
  dropout: 0.3  # Increased for medical imaging

data:
  dataset:
    mode: manifest
    manifest_path: data/otoscopic/subset  # Use subset for quick experiments
    batch_size: 8  # Reduced for 512x512 images
    steps_per_epoch: null  # Use full dataset
    val_steps: null
    num_classes: 5
    image_size: [512, 512]

training:
  epochs: 10
  learning_rate: 0.0001  # Lower LR for medical imaging
  optimizer: adam
  batch_size: 8
  
  tensorboard:
    enabled: true
    profile_batch: 0
  
  checkpoint:
    enabled: true
    monitor: val_loss
    mode: min
    save_freq: 5
  
  early_stopping:
    enabled: true
    monitor: val_loss
    patience: 5
    min_delta: 0.001
    restore_best_weights: true
  
  lr_schedule:
    enabled: true
    type: reduce_on_plateau
    monitor: val_loss
    factor: 0.5
    patience: 3
    min_lr: 0.00001
  
  csv_logger:
    enabled: true

export:
  export:
    saved_model: true
    tflite:
      enabled: true
      quantize: true

evaluation:
  evaluation:
    enabled: true
    num_visualisations: 10  # More visualizations for medical analysis

explainability:
  enabled: true
  max_samples: 20  # More samples for medical review
  save_overlays: true
  classification:
    method: integrated_gradients
    integrated_gradients:
      steps: 50
      internal_batch_size: 1

run:
  seed: 42
  log_vertex_experiments: false
  log_bigquery: false
